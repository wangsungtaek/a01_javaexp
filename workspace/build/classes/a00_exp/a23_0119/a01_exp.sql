--[데이터베이스]
--[하] 1. 사원 테이블 emp60테이블을 emp테이블에서 복사를 하여, empno 프라이머리, ename not null, job (emp의 job데이터), hiredate(2001이후로 입력), sal(0이상)
--        deptno(dept테이블 deptno참조) 로 설정해서 입력 하세요
-- 1) 테이블 복사
CREATE TABLE EMP60 AS SELECT * FROM EMP;

-- 2) 컬럼에 제약조건 추가
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_EMPNO_PK PRIMARY KEY(EMPNO); -- PK
ALTER TABLE EMP60 MODIFY(ENAME CONSTRAINT EMP60_ENAME_NN NOT NULL); -- NOT NULL
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_JOB_FK FOREIGN KEY(JOB) REFERENCES EMP(JOB);
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_JOB_CK
	CHECK(JOB IN('CLERK', 'SALESMAN', 'PRESIDENT', 'MANAGER', 'ANALYST');
UPDATE EMP60 SET HIREDATE = NULL; -- hiredatae 값 업데이트
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_HIREDATE_CK CHECK(HIREDATE > TO_DATE('2001-01-01', 'YYYY-MM-DD')); -- CHECK
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_SAL_CK CHECK(SAL>=0); -- CHECK
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_DEPTNO_RF FOREIGN KEY(DEPTNO) REFERENCES DEPT(DEPTNO); -- 외래키 추가

CREATE TABLE TMP_EMP
AS SELECT EMPNO, ADD_MONTHS(HIREDATE, 12*20) HIREDATE FROM EMP;
UPDATE EMP60 A
   SET HIREDATE = (
   	SELECT HIREDATE FROM TMP_EMP b WHERE a.EMPNO = B.EMPNO);
   );
ALTER TABLE EMP60 ADD CONSTRAINT EMP60_HIREDATE_CK CHECK(
	HIREDATE > TO_DATE('2001-01-01', 'YYYY-MM-DD'));
)

-- DQL
SELECT * FROM EMP60;
SELECT * FROM ALL_CONSTRAINTS WHERE TABLE_NAME='EMP60';
DROP TABLE EMP60;


--[하] 2. emp60 설정된 제약조건, 삭제, 활성화/비활성화 처리를 하세요.
ALTER TABLE EMP60 DISABLE CONSTRAINT EMP60_HIREDATE_CK;
ALTER TABLE EMP60 ENABLE CONSTRAINT EMP60_HIREDATE_CK;

SELECT CONSTRAINT_NAME, STATUS 
  FROM USER_CONSTRAINTS
 WHERE TABLE_NAME='EMP60';